!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("ua-parser-js")):"function"==typeof define&&define.amd?define(["exports","ua-parser-js"],n):n(e.perfReport={},e.UAParser)}(this,function(e,n){"use strict";function t(e){return r(e)||o(e)||i()}function r(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}function o(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function i(){throw new TypeError("Invalid attempt to spread non-iterable instance")}n=n&&n.hasOwnProperty("default")?n.default:n;var a=function(e,n){return-1!==e.indexOf(n)},c=function(e){return function(n){return a(n,e)}},u=c(".js"),s=c(".css"),f=function(e){return["png","jpg","gif","jpeg","webp"].some(function(n){return c(n)(e)})&&!["//pr.map.qq.com","//hm.baidu.com"].some(function(n){return a(e,n)})},p=function(e){return["eot","ttf","woff","woff2","svg"].some(function(n){return c(n)(e)})},d=function(e){return a(e,"output=jsonp")},m=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return e?+e.toFixed(n):0},v=function(e){return e?m(e/Math.pow(2,10)):0},g=function(e,n){var t=new XMLHttpRequest;t.open("POST",e,!1),t.send(n)},w=function(e){var n=e.initiatorType,t=e.name,r=e.domainLookupStart,o=e.domainLookupEnd,i=e.connectStart,a=e.connectEnd,c=e.requestStart,g=e.responseStart,w=e.responseEnd,l=e.transferSize,y={"资源路径":t,"DNS 查找耗时":m(o-r),"建立 TCP 连接耗时":m(a-i),"请求到响应耗时":m(g-c),"请求到响应完成耗时":m(w-c)};void 0!==l&&(y["资源体积"]=v(l));var h="other";switch(n){case"link":h=u(t)?"javascript":s(t)?"css":f(t)?"image":p(t)?"font":"other";break;case"img":h=f(t)?"image":"other";break;case"script":h=d(t)?"api":"javascript";break;case"css":h=f(t)?"image":p(t)?"font":"other";break;case"fetch":case"beacon":case"xmlhttprequest":h="api"}return y["资源类型"]=h,y},l=function(){var e={},n=window.performance.getEntriesByType("navigation");if(!n||!n.length)return e;var t=n[0],r=t.domainLookupStart,o=t.domainLookupEnd,i=t.connectStart,a=t.connectEnd,c=t.requestStart,u=t.responseStart,s=t.responseEnd,f=t.transferSize,p=t.domContentLoadedEventEnd,d=t.domComplete;void 0!==f&&(e["资源体积"]=v(f)),e["DNS 查找耗时"]=m(o-r),e["建立 TCP 连接耗时"]=m(a-i),e["请求到响应耗时"]=m(u-c),e["请求到响应完成耗时"]=m(s-c),e["白屏时间"]=m(p),e["加载完成时间"]=m(d);var g=window.performance.getEntriesByType("paint");if(g.length){var w=g.find(function(e){return"first-contentful-paint"===e.name});w&&(e["白屏时间"]=m(w.startTime))}return e},y=function(){var e=window.performance.getEntriesByType("resource");return e&&e.length?e.reduce(function(e,n){return t(e).concat([w(n)])},[]):[]},h=function(){var e=new n,t=e.getBrowser(),r=e.getOS();return{"浏览器类型":t.name,"浏览器版本":t.version,"系统类型":r.name,"系统版本":r.version}},S=function(e){var n=JSON.stringify(e),t="https://easy-mock.com/mock/5940f4a28ac26d795f00537d/example/logging";"sendBeacon"in navigator?window.navigator.sendBeacon(t,n)||g(t,n):g(t,n)},j=function(e){var n=e.project,t=e.version;if(window.performance&&window.performance.getEntriesByType){var r=Date.now();window.addEventListener("unload",function(){S({project:n,version:t,timestamp:r,device:h(),resource:y(),navigation:l()})},!1)}};e.init=j,Object.defineProperty(e,"__esModule",{value:!0})});
